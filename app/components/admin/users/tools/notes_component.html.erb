<section
  class="crayons-card p-3 js-component"
  data-controller="users--tools--notes"
  data-action="ajax:success@document->users--tools--notes#ajaxSuccess ajax:error@document->users--tools--notes#ajaxError">
  <header>
    <h3><%= link_to "← Notes", admin_user_tools_path(@user.id),
                    remote: true,
                    data: { action: "ajax:success->user#replacePartial" },
                    class: "crayons-title fs-l" %></h3>
  </header>

  <%# Create a new note %>
  <%= form_with model: Note.new,
                url: admin_user_tools_notes_path(@user),
                method: :post,
                remote: true,
                class: "mt-1" do |f| %>
    <div class="crayons-field form-group">
      <%= f.label "Add a new note", class: "crayons-field__label" %>
      <%= f.text_area :content, required: true, class: "crayons-textfield" %>
    </div>

    <%= f.submit "Create Note", class: "crayons-btn", data: { disable_with: "Creating..." } %>
  <% end -%>

  <%# Notes history #%>
  <% if @notes.any? %>
  <article class="mt-5">
    <details>
      <summary class="fw-medium">Recent Notes (<%= @notes.size %>)</summary>

      <ul class="list-none">
        <% @notes.each_with_index do |note, index| %>
          <li class="py-3 pl-3 <%= index == @notes.size - 1 ? "border-b-0" : "border-b-1" %> border-l-0 border-t-0 border-r-0 border-solid border-base-50">
            <local-time datetime="<%= note.created_at.iso8601 %>">
              <%= note.created_at.strftime("%d %B %Y %H:%M %Z") %>
            </local-time>
            by
            <%= note.author&.username %>
            —
            <% if note.reason.present? %>
              <strong><%= note.reason %></strong>:
            <% end -%>
            <%= note.content %>
          </li>
        <% end %>
      </ul>
    </details>
  </article>
  <% else %>
    <div class="crayons-notice mb-6" aria-live="polite">No notes yet...</div>
  <% end %>
</section>
